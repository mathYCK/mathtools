<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>數學單元 3-2 十字交乘法</title>
    
    <!-- 引入 Tailwind CSS (樣式庫) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 引入 React 和 ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- 引入 Babel (讓瀏覽器看不懂的 JSX 語法可以執行) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* 確保在部落格中嵌入時有足夠的高度 */
        #root {
            width: 100%;
            height: 600px; /* 您可以依需求調整高度 */
            overflow: hidden;
        }
        /* 避免與部落格原本的樣式衝突，重置一些基礎設定 */
        .lesson-container {
            font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.5;
        }
    </style>
</head>
<body>

    <!-- 應用程式掛載點 -->
    <div id="root"></div>

    <!-- React 程式邏輯 -->
    <script type="text/babel">
        const { useState } = React;

        // --- 內嵌 SVG 圖示元件 ---
        const IconWrapper = ({ children, size = 24, className = "" }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width={size} 
                height={size} 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className}
            >
                {children}
            </svg>
        );

        const ArrowRight = (props) => (
            <IconWrapper {...props}><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></IconWrapper>
        );

        const ArrowLeft = (props) => (
            <IconWrapper {...props}><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></IconWrapper>
        );

        const Check = (props) => (
            <IconWrapper {...props}><polyline points="20 6 9 17 4 12"/></IconWrapper>
        );

        const X = (props) => (
            <IconWrapper {...props}><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></IconWrapper>
        );

        const RefreshCw = (props) => (
            <IconWrapper {...props}><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></IconWrapper>
        );

        const BookOpen = (props) => (
            <IconWrapper {...props}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></IconWrapper>
        );

        const Calculator = (props) => (
            <IconWrapper {...props}><rect x="4" y="2" width="16" height="20" rx="2"/><line x1="8" y1="6" x2="16" y2="6"/><line x1="16" y1="14" x2="16" y2="14"/><line x1="8" y1="14" x2="8" y2="14"/><line x1="12" y1="14" x2="12" y2="14"/><line x1="16" y1="18" x2="16" y2="18"/><line x1="8" y1="18" x2="8" y2="18"/><line x1="12" y1="18" x2="12" y2="18"/></IconWrapper>
        );

        const Edit3 = (props) => (
            <IconWrapper {...props}><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></IconWrapper>
        );

        const HelpCircle = (props) => (
            <IconWrapper {...props}><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></IconWrapper>
        );

        // --- 主程式開始 ---

        const CrossMultiplicationLesson = () => {
            const [currentSlide, setCurrentSlide] = useState(0);

            // Math styling helper
            const Super = ({ children }) => <sup className="text-sm">{children}</sup>;

            // Slide 1: Intro
            const IntroSlide = () => (
                <div className="flex flex-col items-center justify-center min-h-[50vh] text-center space-y-6 py-8">
                <div className="bg-blue-100 p-6 rounded-full mb-4 animate-bounce">
                    <BookOpen size={64} className="text-blue-600" />
                </div>
                <h1 className="text-4xl font-bold text-gray-800 mb-2">十字交乘法</h1>
                <h2 className="text-2xl text-blue-600 font-semibold">因式分解的核心技巧</h2>
                <p className="text-gray-600 max-w-lg text-lg">
                    這是一種「逆向思考」的藝術。<br/>
                    我們要找出兩個括號，讓它們乘開後回到原本的題目。
                </p>
                <div className="bg-yellow-50 border-l-4 border-yellow-400 p-4 text-left max-w-md mt-8 mx-auto shadow-sm">
                    <p className="font-bold text-yellow-800 flex items-center gap-2">
                    <Edit3 size={18}/> 學習重點：
                    </p>
                    <ul className="list-disc pl-5 text-gray-700 space-y-1 mt-2">
                    <li>學會十字交乘的書寫格式</li>
                    <li><strong>試誤法</strong>：學會列出所有可能性並檢查</li>
                    <li>判斷符號（正負號）</li>
                    </ul>
                </div>
                </div>
            );

            // Slide 2: Concept with Fixed Alignment
            const ConceptSlide = () => (
                <div className="flex flex-col items-center justify-center min-h-full py-8">
                <h2 className="text-3xl font-bold mb-8 text-gray-800">格式怎麼寫？</h2>
                
                <div className="grid grid-cols-1 md:grid-cols-2 gap-12 items-center w-full max-w-4xl px-4">
                    {/* Left: Standard Form */}
                    <div className="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                    <h3 className="text-lg font-bold text-gray-500 mb-4 text-center">目標多項式</h3>
                    <div className="text-4xl font-serif text-center py-4 bg-gray-50 rounded-lg">
                        ax<Super>2</Super> + bx + c
                    </div>
                    </div>

                    {/* Right: The Cross - FIXED LAYOUT */}
                    <div className="bg-white p-8 rounded-xl shadow-lg border border-gray-200 relative">
                    <h3 className="text-lg font-bold text-gray-500 mb-6 text-center">十字交乘圖示</h3>
                    
                    {/* Container with fixed width for perfect alignment */}
                    <div className="w-[240px] mx-auto relative">
                        <div className="flex justify-between text-3xl font-serif mb-12 relative z-10">
                        <div className="text-blue-600 w-16 text-center">dx</div>
                        <div className="text-green-600 w-16 text-center">p</div>
                        </div>

                        {/* SVG Overlay */}
                        <svg className="absolute top-4 left-0 w-full h-[120px] pointer-events-none" style={{zIndex: 0}}>
                        <line x1="32" y1="10" x2="208" y2="90" stroke="#CBD5E1" strokeWidth="4" />
                        <line x1="32" y1="90" x2="208" y2="10" stroke="#CBD5E1" strokeWidth="4" />
                        </svg>

                        <div className="flex justify-between text-3xl font-serif relative z-10">
                        <div className="text-blue-600 w-16 text-center">ex</div>
                        <div className="text-green-600 w-16 text-center">q</div>
                        </div>
                    </div>
                    
                    <div className="mt-6 pt-4 border-t border-gray-100 text-center">
                        <p className="text-gray-600 text-sm">檢驗中間項：</p>
                        <p className="text-xl font-bold text-red-500 mt-1">
                        (dx • q) + (ex • p) = bx
                        </p>
                    </div>
                    </div>
                </div>
                </div>
            );

            // Improved StepByStep Problem with Trial Phase
            const StepByStepProblem = ({ title, problem, trials, correctTrialIndex, steps, explanation }) => {
                const [step, setStep] = useState(0);

                const nextStep = () => setStep(prev => prev + 1);
                const reset = () => setStep(0);

                const isTrialPhase = step === 2 || step === 3;
                const isFinalPhase = step >= 4;

                return (
                <div className="flex flex-col w-full max-w-5xl mx-auto py-4 px-2">
                    <h2 className="text-2xl font-bold text-gray-800 mb-2 text-center md:text-left">{title}</h2>
                    <div className="bg-slate-800 text-white p-4 rounded-lg text-center text-3xl font-serif mb-6 tracking-wider shadow-md">
                    {problem}
                    </div>

                    <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-6 flex flex-col lg:flex-row gap-8 min-h-[450px]">
                    
                    {/* Left: Interactive Area */}
                    <div className="flex-1 flex flex-col items-center pt-4 relative">
                        
                        {/* 1. Head Split */}
                        <div className={`transition-all duration-500 mb-8 ${step >= 1 ? 'opacity-100' : 'opacity-0'}`}>
                            <div className="text-center mb-2 text-gray-400 text-sm font-bold tracking-widest uppercase">第一步：拆頭</div>
                            <div className="flex flex-col items-center gap-8">
                            <div className="text-3xl font-serif text-blue-600 font-bold bg-blue-50 px-4 py-2 rounded border border-blue-100">{steps[0].head1}</div>
                            <div className="text-3xl font-serif text-blue-600 font-bold bg-blue-50 px-4 py-2 rounded border border-blue-100">{steps[0].head2}</div>
                            </div>
                        </div>

                        {/* 2. Trial Phase Area */}
                        {isTrialPhase && (
                        <div className="absolute top-20 w-full max-w-md bg-white z-10 animate-in fade-in slide-in-from-bottom-4 duration-500">
                            <div className="bg-yellow-50 border-2 border-yellow-200 rounded-xl p-4 shadow-lg">
                            <div className="flex items-center justify-center gap-2 text-yellow-800 font-bold mb-3">
                                <HelpCircle size={20} />
                                <span>思考：尾數可以怎麼拆？</span>
                            </div>
                            
                            <div className="grid grid-cols-1 sm:grid-cols-2 gap-3">
                                {trials.map((trial, idx) => (
                                <div key={idx} className={`relative p-3 rounded-lg border-2 transition-all duration-500 flex justify-between items-center
                                    ${step === 3 
                                    ? (idx === correctTrialIndex 
                                        ? 'border-green-500 bg-green-50 scale-105 shadow-md' 
                                        : 'border-red-100 bg-red-50 opacity-50')
                                    : 'border-gray-200 bg-white'
                                    }
                                `}>
                                    <div className="font-serif text-lg text-gray-700">
                                    {trial.pair}
                                    </div>
                                    
                                    {step === 3 && (
                                    <div className="flex items-center">
                                        {idx === correctTrialIndex ? (
                                        <Check className="text-green-600" size={24} />
                                        ) : (
                                        <div className="flex items-center text-red-400">
                                            <span className="text-xs mr-1 font-serif">{trial.sum}</span>
                                            <X size={24} />
                                        </div>
                                        )}
                                    </div>
                                    )}
                                    
                                    {/* Strikethrough line for wrong answers */}
                                    {step === 3 && idx !== correctTrialIndex && (
                                    <div className="absolute inset-0 flex items-center justify-center pointer-events-none">
                                        <div className="w-[90%] h-[2px] bg-red-400 opacity-60 rotate-[-5deg]"></div>
                                    </div>
                                    )}
                                </div>
                                ))}
                            </div>
                            {step === 2 && <div className="text-center text-xs text-gray-500 mt-2">點擊下一步來檢查試誤...</div>}
                            </div>
                        </div>
                        )}

                        {/* 3. Final Cross Diagram (Replaces Trials) */}
                        {isFinalPhase && (
                            <div className="absolute top-0 w-full flex flex-col items-center animate-in zoom-in duration-500">
                            {/* Correct Pair Visualization - FIXED ALIGNMENT */}
                            <div className="w-[280px] relative mt-4">
                                {/* Text Row 1 */}
                                <div className="flex justify-between text-4xl font-serif mb-16 relative z-10 px-6">
                                <div className="text-blue-600 font-bold">{steps[0].head1}</div>
                                <div className="text-green-600 font-bold">{steps[1].tail1}</div>
                                </div>

                                {/* SVG Lines */}
                                <svg className="absolute top-4 left-0 w-full h-[140px] pointer-events-none z-0">
                                    {/* Connecting centers of text roughly */}
                                    <line x1="40" y1="15" x2="240" y2="100" stroke="#94A3B8" strokeWidth="4" />
                                    <line x1="40" y1="100" x2="240" y2="15" stroke="#94A3B8" strokeWidth="4" />
                                </svg>

                                {/* Text Row 2 */}
                                <div className="flex justify-between text-4xl font-serif relative z-10 px-6">
                                <div className="text-blue-600 font-bold">{steps[0].head2}</div>
                                <div className="text-green-600 font-bold">{steps[1].tail2}</div>
                                </div>
                            </div>

                            {/* Check Sum */}
                            <div className="mt-8 p-3 rounded-lg bg-red-50 border border-red-100 animate-in slide-in-from-bottom-2 fade-in duration-700">
                                <p className="text-sm text-red-400 mb-1 font-bold uppercase tracking-widest text-center">CHECK</p>
                                <p className="text-xl font-serif text-red-600 text-center font-bold">
                                {steps[2].check}
                                </p>
                            </div>

                            {/* Final Answer */}
                            {step >= 5 && (
                                <div className="mt-6 bg-green-100 px-8 py-4 rounded-xl text-center border-2 border-green-500 shadow-lg animate-in bounce-in duration-700">
                                <span className="text-green-800 font-bold block text-sm mb-1">因式分解結果：</span>
                                <span className="text-3xl font-serif font-bold text-green-900">{steps[3].result}</span>
                                </div>
                            )}
                            </div>
                        )}
                    </div>

                    {/* Right: Explanation Sidebar */}
                    <div className="w-full lg:w-72 bg-gray-50 rounded-xl p-5 border border-gray-200 flex flex-col h-auto lg:h-full">
                        <h3 className="text-sm font-bold text-gray-400 uppercase mb-4 tracking-wider flex items-center gap-2">
                        <Calculator size={16}/> 解題步驟
                        </h3>
                        <div className="space-y-3 flex-1 overflow-y-auto">
                        {/* Custom Timeline */}
                        <TimelineItem active={step >= 1} current={step === 1} text={explanation[0]} />
                        <TimelineItem active={step >= 2} current={step === 2 || step === 3} text="列出尾數的所有可能組合 (試誤法)" isTrial />
                        <TimelineItem active={step >= 4} current={step === 4} text={explanation[2]} />
                        <TimelineItem active={step >= 5} current={step === 5} text={explanation[3]} />
                        </div>

                        <div className="mt-6 pt-4 border-t border-gray-200">
                        {step < 5 ? (
                            <button 
                            onClick={nextStep}
                            className="w-full py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-bold shadow-lg active:scale-95 transition-all flex items-center justify-center gap-2 group"
                            >
                            {step === 3 ? "確認選定組合" : "下一步"} 
                            <ArrowRight size={18} className="group-hover:translate-x-1 transition-transform"/>
                            </button>
                        ) : (
                            <button 
                            onClick={reset}
                            className="w-full py-3 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-bold shadow-lg active:scale-95 transition-all flex items-center justify-center gap-2"
                            >
                            重來一次 <RefreshCw size={18} />
                            </button>
                        )}
                        </div>
                    </div>
                    </div>
                </div>
                );
            };

            const TimelineItem = ({ active, current, text, isTrial }) => (
                <div className={`flex gap-3 transition-all duration-300 ${active ? 'opacity-100' : 'opacity-40'}`}>
                <div className="flex flex-col items-center">
                    <div className={`w-3 h-3 rounded-full mt-1.5 ${current ? 'bg-blue-500 scale-125 ring-4 ring-blue-100' : (active ? 'bg-green-500' : 'bg-gray-300')}`}></div>
                    <div className={`w-0.5 h-full mt-1 ${active ? 'bg-gray-300' : 'bg-gray-200'}`}></div>
                </div>
                <div className={`pb-4 text-sm ${current ? 'font-bold text-blue-800' : 'text-gray-600'}`}>
                    {text}
                    {isTrial && current && <div className="text-xs text-orange-500 mt-1 font-normal">嘗試各種組合，找出交叉相乘後等於中間項的那一組。</div>}
                </div>
                </div>
            );

            const slides = [
                {
                type: "intro",
                content: <IntroSlide />
                },
                {
                type: "concept",
                content: <ConceptSlide />
                },
                {
                type: "problem",
                title: "Level 1: 基礎題 (試誤體驗)",
                problem: <span>x<Super>2</Super> + 5x + 6</span>,
                explanation: [
                    "拆頭：x² 拆成 x 和 x",
                    "思考：6 可以怎麼拆？",
                    "驗算：找出相加等於 5x 的組合",
                    "寫出答案：(x+2)(x+3)"
                ],
                // New Data for Trials
                trials: [
                    { pair: "1, 6", sum: "7x" },     // 1x + 6x = 7x
                    { pair: "-1, -6", sum: "-7x" },  // -1x - 6x = -7x
                    { pair: "2, 3", sum: "5x" },     // 2x + 3x = 5x (Correct)
                    { pair: "-2, -3", sum: "-5x" }   // -2x - 3x = -5x
                ],
                correctTrialIndex: 2, // Index of correct pair in trials array
                steps: [
                    { head1: "x", head2: "x" },
                    { tail1: "+2", tail2: "+3" },
                    { check: "2x + 3x = 5x (符合)" },
                    { result: "(x + 2)(x + 3)" }
                ]
                },
                {
                type: "problem",
                title: "Level 2: 負號判斷題",
                problem: <span>x<Super>2</Super> - 7x + 12</span>,
                explanation: [
                    "拆頭：x 拆成 x 和 x",
                    "思考：12 拆成同號數，湊 -7",
                    "驗算：負負得正，相加為負",
                    "寫出答案：(x-3)(x-4)"
                ],
                trials: [
                    { pair: "3, 4", sum: "7x" },
                    { pair: "-3, -4", sum: "-7x" }, // Correct
                    { pair: "2, 6", sum: "8x" },
                    { pair: "-2, -6", sum: "-8x" }
                ],
                correctTrialIndex: 1,
                steps: [
                    { head1: "x", head2: "x" },
                    { tail1: "-3", tail2: "-4" },
                    { check: "-3x + (-4x) = -7x (符合)" },
                    { result: "(x - 3)(x - 4)" }
                ]
                },
                {
                type: "problem",
                title: "Level 3: 異號相加 (常數負)",
                problem: <span>x<Super>2</Super> + 2x - 15</span>,
                explanation: [
                    "拆頭",
                    "思考：-15 是一正一負，差要為 +2",
                    "驗算：大數配正號",
                    "寫出答案"
                ],
                trials: [
                    { pair: "1, -15", sum: "-14x" },
                    { pair: "-1, 15", sum: "14x" },
                    { pair: "3, -5", sum: "-2x" },
                    { pair: "-3, 5", sum: "2x" } // Correct
                ],
                correctTrialIndex: 3,
                steps: [
                    { head1: "x", head2: "x" },
                    { tail1: "+5", tail2: "-3" },
                    { check: "5x + (-3x) = 2x (符合)" },
                    { result: "(x + 5)(x - 3)" }
                ]
                }
            ];

            return (
                <div className="flex flex-col h-full bg-gray-50 text-gray-900 font-sans lesson-container">
                {/* Header */}
                <header className="bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-center shadow-sm flex-shrink-0 z-10">
                    <div className="flex items-center gap-2">
                    <Calculator className="text-blue-600" />
                    <span className="font-bold text-lg hidden sm:inline">數學單元 3-2</span>
                    <span className="font-bold text-lg sm:hidden">3-2 十字交乘</span>
                    </div>
                    <div className="flex items-center gap-4 text-sm text-gray-500">
                    <div className="w-24 sm:w-32 h-2 bg-gray-200 rounded-full overflow-hidden">
                        <div 
                        className="h-full bg-blue-600 transition-all duration-300" 
                        style={{ width: `${((currentSlide + 1) / slides.length) * 100}%` }}
                        ></div>
                    </div>
                    <span>{currentSlide + 1} / {slides.length}</span>
                    </div>
                </header>

                {/* Main Content Area - Scrollable */}
                <main className="flex-1 overflow-y-auto bg-gray-50">
                    <div className="w-full max-w-6xl mx-auto p-2 sm:p-6 min-h-full flex flex-col justify-start sm:justify-center">
                    <div className="transition-opacity duration-300 w-full">
                        {slides[currentSlide].type === 'problem' ? (
                        <StepByStepProblem 
                            title={slides[currentSlide].title}
                            problem={slides[currentSlide].problem}
                            steps={slides[currentSlide].steps}
                            trials={slides[currentSlide].trials}
                            correctTrialIndex={slides[currentSlide].correctTrialIndex}
                            explanation={slides[currentSlide].explanation}
                        />
                        ) : (
                        slides[currentSlide].content
                        )}
                    </div>
                    </div>
                </main>

                {/* Navigation Footer */}
                <footer className="bg-white border-t border-gray-200 p-3 sm:p-4 flex justify-center items-center gap-6 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] flex-shrink-0 z-10">
                    <button 
                    onClick={() => setCurrentSlide(Math.max(0, currentSlide - 1))}
                    disabled={currentSlide === 0}
                    className={`flex items-center gap-2 px-4 sm:px-6 py-2 rounded-lg font-medium transition-all ${
                        currentSlide === 0 
                        ? 'bg-gray-100 text-gray-400 cursor-not-allowed' 
                        : 'bg-white border border-gray-300 text-gray-700 hover:bg-gray-50 hover:shadow-md'
                    }`}
                    >
                    <ArrowLeft size={20} /> <span className="hidden sm:inline">上一頁</span>
                    </button>

                    <span className="font-bold text-gray-500 text-sm sm:text-base min-w-[120px] text-center">
                    {slides[currentSlide].title || "教學解說"}
                    </span>

                    <button 
                    onClick={() => setCurrentSlide(Math.min(slides.length - 1, currentSlide + 1))}
                    disabled={currentSlide === slides.length - 1}
                    className={`flex items-center gap-2 px-4 sm:px-6 py-2 rounded-lg font-medium transition-all ${
                        currentSlide === slides.length - 1
                        ? 'bg-gray-100 text-gray-400 cursor-not-allowed' 
                        : 'bg-blue-600 text-white hover:bg-blue-700 shadow-md hover:shadow-lg'
                    }`}
                    >
                    <span className="hidden sm:inline">下一頁</span> <ArrowRight size={20} />
                    </button>
                </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<CrossMultiplicationLesson />);
    </script>
</body>
</html>
